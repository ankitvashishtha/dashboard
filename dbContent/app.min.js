var baseUrl="http://descg.gov.in/emps/",app=angular.module("dashboardApp",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,a){e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"dbView/dbHome.html",controller:"globleCtrl"}).state("compDashboard",{url:"/compDashboard",templateUrl:"dbView/dbComp.html",controller:"globleCtrl"}).state("india",{url:"/india",templateUrl:"dbView/dbIndia.html",controller:"globleCtrl"}).state("setting",{url:"/setting",templateUrl:"dbView/dbSetting.html",controller:"globleCtrl"}).state("login",{url:"/login",templateUrl:"dbView/dbLogin.html",controller:"globleCtrl"}).state("additionalData",{url:"/additionalData",templateUrl:"dbView/dbAdditionalData.html",controller:"globleCtrl"}),a.html5Mode(!0)}]),app.controller("filterCtrl",["$scope","$http",function(t,e){t.setSectors=function(){NProgress.start(),e({method:"GET",url:baseUrl+"api/dashboard/getSector"}).then(function(e){t.sectors=e.data,t.ddlSector=t.sectors[0],t.setIndicators()},function(t){alert("Error indicator")})},t.setIndicators=function(){NProgress.start(),e({method:"GET",url:baseUrl+"api/dashboard/getIndicator",params:{sectorId:t.ddlSector.id}}).then(function(e){t.indicators=e.data,t.ddlIndicator=t.indicators[0],t.setYearDdl()},function(t){alert("Error indicator")})},t.setYearDdl=function(){NProgress.start(),e({method:"GET",url:baseUrl+"api/dashboard/getYear",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id}}).then(function(e){t.years=e.data,t.ddlYear=t.years[0],t.setSourceDdl()},function(t){alert("Error year")})},t.setSourceDdl=function(){NProgress.start(),e({method:"GET",url:baseUrl+"api/dashboard/getSources",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id,yearId:t.ddlYear.year}}).then(function(e){t.sources=e.data,t.ddlSource=t.sources[0],t.setMapDdl()},function(t){alert("Error source")})},t.setMapDdl=function(){NProgress.start(),e({method:"GET",url:baseUrl+"api/dashboard/getMapName",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id,yearId:t.ddlYear.year,sourceId:t.ddlSource.id}}).then(function(e){t.maps=e.data,t.ddlMap=t.maps[0],t.getAllData()},function(t){alert("Error map")})},t.getAllData=function(){NProgress.start(),lowerLimit=parseInt($("#lowerLimit").val());$("#ddlIndicator").val();IndicatorName=$("#ddlIndicator option:selected").text(),e({method:"GET",url:baseUrl+"api/dashboard/getAllData",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id,yearId:t.ddlYear.year,sourceId:t.ddlSource.id,mapId:t.ddlMap.id,areaLevel:t.areaLevel}}).then(function(e){t.setDashboard(e.data),NProgress.done()},function(t){alert("Error dashboard")})},t.setSectors()}]),app.controller("dashboardCtrl",["$scope","$http",function(t,e){function a(t){for(var e="",a=0,r=10240;a<t.byteLength/r;++a)e+=String.fromCharCode.apply(null,new Uint8Array(t.slice(a*r,a*r+r)));return e+=String.fromCharCode.apply(null,new Uint8Array(t.slice(a*r)))}function r(t){var e={},a={};t.SheetNames.forEach(function(r){var o=l.utils.sheet_to_row_object_array(t.Sheets[r]);o.length>0&&(e[r]=o),a=Object.keys(t.Sheets)}),$("#ddlIndicatorExcel").empty(),$("#ddlYearExcel").empty(),$("#ddlIndicator").hide(),$("#ddlYear").hide(),$("#ddlIndicatorExcel").show(),$("#ddlYearExcel").show();var r=Object.keys(e[a[0]][0]);return $.each(r,function(t,e){t>1&&$("#ddlIndicatorExcel").append($("<option></option>").val(e).html(e))}),$.each(a,function(t,e){$("#ddlYearExcel").append($("<option></option>").val(e).html(e))}),e}function o(e){var a=JSON.stringify(r(e),2,2);excelOutput=a,a=$.parseJSON(a),excelOutput=$.parseJSON(excelOutput),yearName=$("#ddlYearExcel").val(),columnName=$("#ddlIndicatorExcel").val(),IndicatorName=$("#ddlIndicatorExcel option:selected").text();var o=[],n=a[yearName].length-5,i=a[yearName][n+1].Name,d=a[yearName][n+2].Name,s=a[yearName][n+3],l=a[yearName][n+4];$("#ddlSector").empty(),$("#ddlSector").append($("<option></option>").val(i).html(i)),$("#ddlSource").empty(),$("#ddlSource").append($("<option></option>").val(d).html(d)),$("#src").text(d);for(var c=0;n>c;c++)null==a[yearName][c][columnName]&&(a[yearName][c][columnName]=-1);for(var c=0;n>c;c++)o.push({id:a[yearName][c].Id,rank:0,name:a[yearName][c].Name,values:parseFloat(a[yearName][c][columnName]),color:"silver",unit:s[columnName]});for(var m=JSON.parse(JSON.stringify(o)),p=m.sort(t.SortByVal),u=0;n>u;u++)p[u].rank=n-u;var g=m.sort(t.SortByName),h=1;("Negative"==l[columnName]||"negative"==l[columnName]||"NEGATIVE"==l[columnName])&&(h=2),t.mapName="cg"+g.length+".json";var f={id:a[yearName][n].Id,rank:28,name:a[yearName][n].Name,values:parseFloat(a[yearName][n][columnName]),color:"#000",mapUrl:t.mapName,unit:s[columnName],natureId:h},x=[f,g];t.setDashboard(x),t.setChartLimit()}function n(t){t.stopPropagation(),t.preventDefault();var e=t.dataTransfer.files,r=e[0],n=new FileReader;r.name;n.onload=function(t){var e,r=t.target.result,n=a(r);e=l.read(btoa(n),{type:"base64"}),o(e)},n.readAsArrayBuffer(r)}function d(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}function s(t){var e=t.target.files,r=e[0],n=new FileReader;r.name;n.onload=function(t){var e,r=t.target.result,n=a(r);e=l.read(btoa(n),{type:"base64"}),o(e)},n.readAsArrayBuffer(r)}t.stp=1,t.pdfLoader="fa-file-pdf-o",t.pdfBook="fa-book",t.areaLevel=2,$("#ddlIndicatorExcel").hide(),$("#ddlYearExcel").hide(),t.setDashboard=function(e){t.cgData=e[0],t.aData=e[1],$(".tooltip").hide(),t.mapUrl="map/"+t.cgData.mapUrl,t.natureId=t.cgData.natureId,t.noOfDist=t.aData.length;var a=JSON.parse(JSON.stringify(t.aData)),r=a.sort(t.SortByRank);t.n=Object.keys(r).map(function(t){return r[t].name+"("+r[t].rank+")"}),t.label=Object.keys(r).map(function(t){return r[t].name}),t.ds=Object.keys(r).map(function(t){return r[t].values}),t.higherLimit=t.ds[0],"Percent"==t.cgData.unit||"Ratio"==t.cgData.unit||"Rate"==t.cgData.unit?(t.mins=.01,t.tofix=2,t.stp=.01):(t.mins=1,t.tofix=0,t.stp=1),0!=t.aData.length?($("#map").text(""),t.setLegend(),"NA"==t.cgData.values?$("#legendsection").hide():$("#legendsection").show(),$("#distName").text(t.cgData.name),$("#cgData").text(t.cgData.values.toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#txtUnit").text(t.cgData.unit),$("#txtCG").text(IndicatorName),t.setCentralTendancy(t.label,t.ds),t.loadChart(t.n,t.ds)):($("#map").html("<b style='font-size:36px;  margin-left:150px'>No Data</b>"),$("#chartSection").html("<b style='font-size:36px;  margin-left:250px'>No Data</b>"))},t.setChartLimit=function(){for(var e=0,a=JSON.parse(JSON.stringify(t.ds)),r=0;r<t.ds.length;r++)t.ds[r]>t.lowerLimit?e+=1:a[r]=t.lowerLimit;t.noOfDist=e,t.loadChart(t.n,a)},t.SortByRank=function(t,e){var a=parseInt(t.rank),r=parseInt(e.rank);return r>a?-1:a>r?1:0},t.SortByVal=function(t,e){var a=parseFloat(t.values),r=parseFloat(e.values);return r>a?-1:a>r?1:0},t.SortByRankDesc=function(t,e){var a=parseInt(e.rank),r=parseInt(t.rank);return r>a?-1:a>r?1:0},t.SortByName=function(t,e){var a=t.name,r=e.name;return r>a?-1:a>r?1:0},t.setMap=function(){t.aData.sort(t.SortByName);var e,a=358,r=580;d3.select("#mapsvg").remove();var o=d3.geo.mercator().scale(4780).center([82.3224595,20.97702712140104]).translate([a/2,r/2]),n=d3.geo.path().projection(o);d3.json(t.mapUrl,function(o){function i(e,a){p.transition().duration(200).style("opacity",.8),$("#cgData").html(t.aData[a].values.toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#distName").text(t.aData[a].name)}function d(e,a){p.html("District: "+t.aData[a].name+"<br/> Rank: "+t.aData[a].rank+"<br/>"+t.aData[a].values.toFixed(t.tofix)).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-110+"px")}function s(){p.transition().duration(500).style("opacity",0),$("#cgData").html(t.cgData.values.toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#distName").text(t.cgData.name)}function l(t){var o,i,d;if(t&&e!==t){var s=n.centroid(t);o=s[0],i=s[1],d=4,e=t}else o=a/2,i=r/2,d=1,e=null;m.selectAll("path").classed("active",e&&function(t){return t===e}),m.transition().duration(750).attr("transform","translate("+a/2+","+r/2+")scale("+d+")translate("+-o+","+-i+")").style("stroke-width",1.5/d+"px")}var c=d3.select("body").select("#map").append("svg").attr("id","mapsvg").attr("width",350).attr("height",570),m=c.selectAll("g").data(o.features).enter().append("g").on("click",l),p=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);m.append("path").attr("d",n).style("fill",function(e,a){return t.aData[a].color}).style("stroke","white").on("mouseover",i).on("mousemove",d).on("mouseout",s).style("stroke-width",1);m.append("text").attr("class","maptxt").attr("x",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.1:"GARIYABAND"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.94:"JANJGIR-CHAMPA"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.07:"BEMETARA"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"RAIPUR"==t.aData[a].name.toUpperCase()&&"map/cg18.json"==t.mapUrl?n.centroid(e)[0]/1:n.centroid(e)[0]}).attr("y",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").text(function(e,a){return t.aData[a].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}).attr("font-size",11.5).on("mouseover",i).on("mousemove",d).on("mouseout",s),m.append("text").attr("class","mapvals").attr("x",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.07:"GARIYABAND"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.94:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[0]:n.centroid(e)[0]/1}).attr("y",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").html(function(e,a){return-1==t.aData[a].values?"":t.aData[a].values.toFixed(t.tofix)}).attr("transform","translate(0,10)").attr("font-size",10).on("mouseover",i).on("mousemove",d).on("mouseout",s)})},t.loadChart=function(e,a){$("#chartSection").html(' <canvas id="barChart" height="135px" style="width:100%;"> </canvas>');var r=document.getElementById("barChart");new Chart(r,{type:"bar",data:{labels:e,datasets:[{label:IndicatorName,data:a,scaleFontColor:"#ff0000",backgroundColor:"#26B99A"}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!1,min:t.lowerLimit,fontColor:"#000"},gridLines:{display:!1}}],xAxes:[{ticks:{fontSize:"10",categorySpacing:"20",fontColor:"#000"},barPercentage:.3,gridLines:{display:!1}}]}}})},t.setCentralTendancy=function(e,a){var r=0;for(i=0;i<a.length;i++)r+=a[i];r/=a.length,t.meanValue=r.toFixed(t.tofix),t.nearMean=e[t.getClosest(r,a)];var o=0,n=Math.floor(a.length/2);a.length%2==1?(t.medianValue=a[n].toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),t.nearMedian=e[n]):(o=(a[n-1]+a[n])/2,t.medianValue=o.toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),t.nearMedian=e[n-1]+" and \n "+e[n]),t.range=a[a.length-1].toFixed(t.tofix)+"-"+a[0].toFixed(t.tofix)},t.getClosest=function(t,e){for(var a=0,r=Math.abs(t-a),o=e.length;o--;){var n=Math.abs(t-e[o]);r>n&&(r=n,a=o)}return a},t.setLegend=function(){var e=0,a=0,r=0;$.each(t.ds,function(t,e){-1!=e&&r++}),r>2&&(e=Math.floor(r/3),a=2*e,r%3==2&&(e++,a++)),2==t.natureId&&t.ds.sort(function(t,e){return e-t}),$("#txthigh2").val((t.ds[e]+t.mins).toFixed(t.tofix)),$("#txthigh1").val(t.ds[0].toFixed(t.tofix)),$("#txtmid2").val((t.ds[a]+t.mins).toFixed(t.tofix)),$("#txtmid1").val(t.ds[e].toFixed(t.tofix)),$("#txtlow2").val(t.ds[r-1].toFixed(t.tofix)),$("#txtlow1").val(t.ds[a].toFixed(t.tofix)),2==t.natureId&&t.ds.sort(function(t,e){return t-e}),t.setCustomLegend()},t.setCustomLegend=function(){var e,a="",r="",o="",n=parseFloat($("#txtmid1").val()),d=parseFloat($("#txtmid2").val()),s=parseFloat($("#txtlow1").val()),l=parseFloat($("#txtlow2").val()),c=parseFloat($("#txthigh1").val()),m=parseFloat($("#txthigh2").val()),p=0,u=0,g=0;if(c>m&&n>d&&s>l){if(t.aData.sort(t.SortByRank),2==t.natureId)for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData[i].values.toFixed(t.tofix)),e>=l&&s>=e&&(t.aData[i].color="rgb(112, 219, 112)",a=a+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",p+=1),e>=d&&n>=e&&(t.aData[i].color="rgb(255, 184, 77)",r=r+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",u+=1),e>=m&&c>=e&&(t.aData[i].color="rgb(255, 121, 77)",o=o+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",g+=1);else for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData[i].values.toFixed(t.tofix)),e>=l&&s>=e&&(t.aData[i].color="rgb(255, 121, 77)",o=o+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",g+=1),e>=d&&n>=e&&(t.aData[i].color="rgb(255, 184, 77)",r=r+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",u+=1),e>=m&&c>=e&&(t.aData[i].color="rgb(112, 219, 112)",a=a+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",p+=1);$(".high2").text($("#txthigh2").val()),$(".high1").text($("#txthigh1").val()),$(".mid2").text($("#txtmid2").val()),$(".mid1").text($("#txtmid1").val()),$(".low2").text($("#txtlow2").val()),$(".low1").text($("#txtlow1").val()),$("#highDist").text(a),$("#midDist").text(r),$("#lowDist").text(o),$("#highTotal").text(p),$("#midTotal").text(u),$("#lowTotal").text(g),t.aData.sort(t.SortByName),t.setMap()}else alert("invalid value")},t.getCount=function(){e({method:"GET",url:baseUrl+"api/dashboard/GetCount"}).then(function(e){t.unitCount=e.data},function(t){alert("Error count")})},t.getCount(),t.pdfDownload=function(){t.pdfLoader="fa-spinner fa-spin";var e,a=$("#map"),r=$("#chartSection");$("#map").css("color","rgba(0,0,250,0)"),$("#map").css("background-color","white"),$("#barChart").css("background-color","rgb(255,255,255)");var o=new jsPDF("landscape"),n=o.internal.pageSize.width,i=o.internal.pageSize.height;html2canvas(a,{onrendered:function(t){e=t;var a=e.toDataURL("image/jpeg",1);o.addImage(a,"JPEG",10,50,n-200,i-86),$("#map").removeAttr("style"),o.setDrawColor(0),o.setFillColor(0,102,0),o.rect(60,140,5,5,"FD"),o.setFillColor(255,204,0),o.rect(60,148,5,5,"FD"),o.setFillColor(255,0,0),o.rect(60,156,5,5,"FD"),o.setFillColor(152,159,165),o.rect(60,164,5,5,"FD"),o.text(70,145,document.getElementById("high2").innerText+" - "+document.getElementById("high1").innerText),o.text(70,153,document.getElementById("mid2").innerText+" - "+document.getElementById("mid1").innerText),o.text(70,161,document.getElementById("low2").innerText+" - "+document.getElementById("low1").innerText),o.text(70,169,"Not Available")}}),html2canvas(r,{onrendered:function(a){e=a;var r=e.toDataURL("image/jpeg",1);o.addImage(r,"JPEG",90,45,200,90),o.addPage();for(var n=["Sno","District",$("#ddlIndicator option:selected").text()+" ["+$("#ddlYear option:selected").text()+"]"],i=[],d=0;d<t.label.length;d++)i[d]=[d+1,t.label[d],t.ds[d]];o.autoTable(n,i),o.save("CG Dasboard.pdf"),t.pdfLoader="fa-file-pdf-o",t.$apply()}}),o.setFontSize(15),o.text(100,40,document.getElementById("txtCG").innerText+" ("+document.getElementById("txtUnit").innerText+")"),o.text(15,30,document.getElementById("DivisionValue").innerText),o.text(55,30,document.getElementById("DisValue").innerText),o.text(95,30,document.getElementById("TehValue").innerText),o.text(145,30,document.getElementById("BlkValue").innerText),o.text(190,30,document.getElementById("GpValue").innerText),o.text(n-45,30,document.getElementById("VilValue").innerText),o.text(110,160,document.getElementById("cgData").innerText),o.text(161,160,document.getElementById("nearMean").innerText),o.text(211,160,document.getElementById("nearMedian").innerText),$("#population").removeClass("popCounter"),o.text(10,192,document.getElementById("population").innerText),$("#population").addClass("popCounter"),o.setFontSize(10);var d=o.splitTextToSize(document.getElementById("highDist").innerText,75),s=o.splitTextToSize(document.getElementById("midDist").innerText,75),l=o.splitTextToSize(document.getElementById("lowDist").innerText,75);o.text(55,187,d),o.text(135,187,s),o.text(215,187,l),o.text(250,155,document.getElementById("meanLower").innerText),o.text(250,163,document.getElementById("medianLower").innerText),o.text(250,170,document.getElementById("rangeText").innerText),o.text(10,10,document.getElementById("txtHeading").innerText);var c=new Date;$("#chartText").html(c),o.text(190,10,document.getElementById("chartText").innerText),$("#chartText").text("  "),o.setTextColor(0,0,165),o.setLineWidth(.2),o.line(10,12,n-10,12),o.line(10,32,n-10,32),o.line(10,140,n-10,140),o.line(10,175,n-10,175),o.setTextColor(0,0,165),o.text(10,20,document.getElementById("DivisionText").innerText+":"),o.text(50,20,document.getElementById("DisText").innerText+":"),o.text(90,20,document.getElementById("TehText").innerText+":"),o.text(140,20,document.getElementById("BlkText").innerText+":"),o.text(185,20,document.getElementById("GpText").innerText+":"),o.text(n-50,20,document.getElementById("VilText").innerText+":"),o.text(10,47,document.getElementById("txtSource").innerText),o.text(110,147,document.getElementById("distName").innerText),o.text(110,170,document.getElementById("txtCG").innerText+" ("+document.getElementById("txtUnit").innerText+")"),o.text(160,147,document.getElementById("nearMeanTxt").innerText),o.text(160,170,document.getElementById("meanLower").innerText),o.text(210,147,document.getElementById("nearMedianTxt").innerText),o.text(210,170,document.getElementById("medianLower").innerText),o.text(250,147,document.getElementById("ctText").innerText),o.text(10,181,document.getElementById("PopClock").innerText),o.text(10,202,document.getElementById("PopState").innerText),o.text(55,181,document.getElementById("highText").innerText),o.text(135,181,document.getElementById("midText").innerText),o.text(215,181,document.getElementById("lowText").innerText),o.text(55,202,"Total : "+document.getElementById("highTotal").innerText),o.text(135,202,"Total : "+document.getElementById("midTotal").innerText),o.text(215,202,"Total : "+document.getElementById("lowTotal").innerText),o.setTextColor(0,0,0),o.text(25,47,document.getElementById("src").innerText);document.getElementById("download")},t.pdf=function(){t.pdfBook="fa-spinner fa-spin";var e,a=$("#map"),r=$("#chartSection");$("#map").css("color","rgba(0,0,250,0)"),$("#map").css("background-color","white"),$("#barChart").css("background-color","rgb(255,255,255)");var o=new jsPDF("landscape"),n=o.internal.pageSize.width,i=o.internal.pageSize.height;html2canvas(a,{onrendered:function(t){e=t;var a=e.toDataURL("image/jpeg",1);o.addImage(a,"JPEG",8,33,n-200,i-70),$("#map").removeAttr("style"),o.setDrawColor(0),o.setFillColor(0,102,0),o.rect(60,158,5,5,"FD"),o.setFillColor(255,204,0),o.rect(60,166,5,5,"FD"),o.setFillColor(255,0,0),o.rect(60,174,5,5,"FD"),o.text(70,162,document.getElementById("high2").innerText+" - "+document.getElementById("high1").innerText),o.text(70,170,document.getElementById("mid2").innerText+" - "+document.getElementById("mid1").innerText),o.text(70,178,document.getElementById("low2").innerText+" - "+document.getElementById("low1").innerText)}}),html2canvas(r,{onrendered:function(a){e=a;var r=e.toDataURL("image/jpeg",1);o.addImage(r,"JPEG",90,35,200,120),o.save("CG Dasboard.pdf"),t.pdfBook="fa-book",t.$apply()}}),o.setFontSize(12),o.text(100,30,document.getElementById("txtCG").innerText+" ("+document.getElementById("txtUnit").innerText+")"),o.setFontSize(15),o.text(80,15,document.getElementById("txtHeading").innerText),o.setTextColor(0,0,165),o.setLineWidth(.2),o.line(10,22,n-10,22),o.setFontSize(10),o.text(10,30,document.getElementById("txtSource").innerText),o.text(60,30,"Year:"),o.setTextColor(0,0,0),o.text(25,30,document.getElementById("src").innerText),o.text(70,30,$("#ddlYear option:selected").text());document.getElementById("download")},t.csvDownload=function(){var e="";e+="Sector,"+$("#ddlSector option:selected").text()+",Indicator,"+$("#ddlIndicator option:selected").text(),e+="\r\n",e+="Year,"+$("#ddlYear option:selected").text()+",Source,"+$("#ddlSource option:selected").text(),e+="\r\n\n";var a=!0;if(a){var r="";r+="District,"+$("#ddlIndicator option:selected").text()+",Rank",e+=r+"\r\n"}for(var o=0;o<t.aData.length;o++){var r="";r+='"'+t.aData[o].name+'",',r+='"'+t.aData[o].values+'",',r+='"'+t.aData[o].rank+'"',e+=r+"\r\n"}var r="";if(r+='"'+t.cgData.name+'",',r+='"'+t.cgData.values+'",',r+='" "',e+=r+"\r\n",""==e)return void alert("Invalid data");var n="DES",i="data:text/csv;charset=utf-8,"+escape(e),d=document.createElement("a");d.href=i,d.style="visibility:hidden",d.download=n+".csv",document.body.appendChild(d),d.click(),document.body.removeChild(d)};var l=XLSX,c=document.getElementById("drop");c.addEventListener&&(c.addEventListener("dragenter",d,!1),c.addEventListener("dragover",d,!1),c.addEventListener("drop",n,!1));var m=document.getElementById("xlf");t.getAllDataExcel=function(){yearName=$("#ddlYearExcel").val(),columnName=$("#ddlIndicatorExcel").val(),IndicatorName=$("#ddlIndicatorExcel option:selected").text();var e=[],a=excelOutput[yearName].length-5,r=excelOutput[yearName][a+1].Name,o=excelOutput[yearName][a+2].Name,n=excelOutput[yearName][a+3],i=excelOutput[yearName][a+4];$("#ddlSector").empty(),$("#ddlSector").append($("<option></option>").val(r).html(r)),$("#src").text(o);for(var d=0;a>d;d++)null==excelOutput[yearName][d][columnName]&&(excelOutput[yearName][d][columnName]=-1);for(var d=0;a>d;d++)e.push({id:excelOutput[yearName][d].Id,rank:0,name:excelOutput[yearName][d].Name,values:parseFloat(excelOutput[yearName][d][columnName]),color:"silver",unit:n[columnName]});for(var s=JSON.parse(JSON.stringify(e)),l=s.sort(t.SortByVal),c=0;a>c;c++)l[c].rank=a-c;var m=s.sort(t.SortByName),p=1;("Negative"==i[columnName]||"negative"==i[columnName]||"NEGATIVE"==i[columnName])&&(p=2);var u={id:excelOutput[yearName][a].Id,rank:28,name:excelOutput[yearName][a].Name,values:parseFloat(excelOutput[yearName][a][columnName]),color:"#000",mapUrl:t.mapName,unit:n[columnName],natureId:p},g=[u,m];t.setDashboard(g),t.setChartLimit()},m&&m.addEventListener("change",s,!1)}]),app.controller("custumIndicatorCtrl",["$scope","$http",function(t,e){t.setSectorNum=function(){e({method:"GET",url:baseUrl+"api/dashboard/getSector"}).then(function(e){t.sectorsNum=e.data,t.ddlSectorNum=t.sectorsNum[0]},function(t){alert("Error indicator num")})},t.setIndicatorsNum=function(){e({method:"GET",url:baseUrl+"api/dashboard/getIndicator",params:{sectorId:t.ddlSectorNum}}).then(function(e){t.indicatorsNum=e.data,t.ddlIndicatorNum=t.indicatorsNum[0],t.setYearDdlNum()},function(t){alert("Error indicator num")})},t.setYearDdlNum=function(){e({method:"GET",url:baseUrl+"api/dashboard/getYear",params:{sectorId:t.ddlSectorNum,indicatorId:t.ddlIndicatorNum.id}}).then(function(e){t.yearsNum=e.data,t.ddlYearNum=t.yearsNum[0],t.setSourceDdlNum()},function(t){alert("Error year")})},t.setSourceDdlNum=function(){e({method:"GET",url:baseUrl+"api/dashboard/getSources",params:{sectorId:t.ddlSectorNum,indicatorId:t.ddlIndicatorNum.id,yearId:t.ddlYearNum.year}}).then(function(e){t.sourcesNum=e.data,t.ddlSourceNum=t.sourcesNum[0],t.setMapDdlNum()},function(t){alert("Error source")})},t.setMapDdlNum=function(){e({method:"GET",url:baseUrl+"api/dashboard/getMapName",params:{sectorId:t.ddlSectorNum,indicatorId:t.ddlIndicatorNum.id,yearId:t.ddlYearNum.year,sourceId:t.ddlSourceNum.id}}).then(function(e){t.mapsNum=e.data,t.ddlMapNum=t.mapsNum[0]},function(t){alert("Error map")})},t.setIndicatorsDen=function(){e({method:"GET",url:baseUrl+"api/dashboard/getIndicator",params:{sectorId:t.ddlSectorDen}}).then(function(e){t.indicatorsDen=e.data,t.ddlIndicatorDen=t.indicatorsDen[0],t.setYearDdlDen()},function(t){alert("Error indicator num")})},t.setYearDdlDen=function(){e({method:"GET",url:baseUrl+"api/dashboard/getYear",params:{sectorId:t.ddlSectorDen,indicatorId:t.ddlIndicatorDen.id}}).then(function(e){t.yearsDen=e.data,t.ddlYearDen=t.yearsDen[0],t.setSourceDdlDen()},function(t){alert("Error year")})},t.setSourceDdlDen=function(){e({method:"GET",url:baseUrl+"api/dashboard/getSources",params:{sectorId:t.ddlSectorDen,indicatorId:t.ddlIndicatorDen.id,yearId:t.ddlYearDen.year}}).then(function(e){t.sourcesDen=e.data,t.ddlSourceDen=t.sourcesDen[0],t.setMapDdlDen()},function(t){alert("Error source")})},t.setMapDdlDen=function(){e({method:"GET",url:baseUrl+"api/dashboard/getMapName",params:{sectorId:t.ddlSectorDen,indicatorId:t.ddlIndicatorDen.id,yearId:t.ddlYearDen.year,sourceId:t.ddlSourceDen.id}}).then(function(e){t.mapsDen=e.data,t.ddlMapDen=t.mapsDen[0]},function(t){alert("Error map")})},t.getCustomData=function(){t.customData={sectorIdNum:t.ddlSectorNum,sectorIdDen:t.ddlSectorDen,indicatorIdNum:t.ddlIndicatorNum.id,indicatorIdDen:t.ddlIndicatorDen.id,yearIdNum:t.ddlYearNum.year,yearIdDen:t.ddlYearDen.year,sourceIdNum:t.ddlSourceNum.id,sourceIdDen:t.ddlSourceDen.id,mapIdNum:t.ddlMapNum.id,mapIdDen:t.ddlMapDen.id,multiplier:t.multiplier,operat:t.operator},e({method:"POST",url:baseUrl+"api/dashboard/getCustomIndicator",data:t.customData}).then(function(e){IndicatorName=t.indicatorName,t.setDashboard(e.data)},function(t){alert("Error dashboard")})}}]),app.controller("comparisonCtrl",["$scope","$http",function(t,e){t.stp=1,t.pdfLoader="fa-file-pdf-o",t.areaLevel=2,t.setSectors=function(){NProgress.start(),e({method:"GET",url:baseUrl+"api/dashboard/getSector"}).then(function(e){t.sectors=e.data,t.ddlSector=t.sectors[0],t.setIndicators()},function(t){alert("Error indicator")})},t.setIndicators=function(){e({method:"GET",url:baseUrl+"api/dashboard/getIndicator",params:{sectorId:t.ddlSector.id}}).then(function(e){t.indicators=e.data,t.ddlIndicator=t.indicators[0],t.setYearDdl()},function(t){alert("Error indicator")})},t.setYearDdl=function(){e({method:"GET",url:baseUrl+"api/dashboard/getYear",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id}}).then(function(e){t.years=e.data,t.ddlYear=t.years[0],t.setSourceDdl()},function(t){alert("Error year")})},t.setSourceDdl=function(){e({method:"GET",url:baseUrl+"api/dashboard/getSources",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id,yearId:t.ddlYear.year}}).then(function(e){t.sources=e.data,t.ddlSource=t.sources[0],t.setMapDdl()},function(t){alert("Error source")})},t.setMapDdl=function(){e({method:"GET",url:baseUrl+"api/dashboard/getMapName",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id,yearId:t.ddlYear.year,sourceId:t.ddlSource.id}}).then(function(e){t.maps=e.data,t.ddlMap=t.maps[0],t.getAllData()},function(t){alert("Error map")})},t.getAllData=function(){lowerLimit=parseInt($("#lowerLimit").val());$("#ddlIndicator").val();IndicatorName=$("#ddlIndicator option:selected").text(),e({method:"GET",url:baseUrl+"api/dashboard/getAllData",params:{sectorId:t.ddlSector.id,indicatorId:t.ddlIndicator.id,yearId:t.ddlYear.year,sourceId:t.ddlSource.id,mapId:t.ddlMap.id,areaLevel:t.areaLevel}}).then(function(e){t.setDashboard2(e.data)},function(t){alert("Error dashboard")})},t.setSectors(),t.SortByRank=function(t,e){var a=parseInt(t.rank),r=parseInt(e.rank);return r>a?-1:a>r?1:0},t.SortByName=function(t,e){var a=t.name,r=e.name;return r>a?-1:a>r?1:0},t.setDashboard=function(e){t.cgData=e[0],t.aData=e[1],t.barData=Object.keys(t.aData).map(function(e){return t.aData[e].values}),t.barLable=Object.keys(t.aData).map(function(e){return t.aData[e].name}),$(".tooltip").hide(),t.mapUrl="map/"+t.cgData.mapUrl,t.noOfDist=t.aData.length,t.natureId=t.cgData.natureId,t.firstDataIndi=$("#ddlIndicator option:selected").text();var a=JSON.parse(JSON.stringify(t.aData)),r=a.sort(t.SortByRank);t.n=Object.keys(r).map(function(t){return r[t].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}),t.ds=Object.keys(r).map(function(t){return r[t].values}),t.higherLimit=t.ds[0],"Percent"==t.cgData.unit||"Ratio"==t.cgData.unit||"Rate"==t.cgData.unit?(t.mins=.01,t.tofix=2,t.stp=.01):(t.mins=1,t.tofix=0,t.stp=1),0!=t.aData.length?($("#map").text(""),t.setLegend(),t.setMap(),t.loadHbarChart(),t.loadChart2(),"NA"==t.cgData.values?$("#legendsection").hide():$("#legendsection").show()):($("#map").html("<b style='font-size:36px;  margin-left:150px'>No Data</b>"),$("#chartSection").html("<b style='font-size:36px;  margin-left:250px'>No Data</b>"))},t.setDashboard2=function(e){t.cgData2=e[0],t.aData2=e[1],t.barData2=Object.keys(t.aData2).map(function(e){return t.aData2[e].values}),$(".tooltip").hide(),t.mapUrl2="map/"+t.cgData2.mapUrl,t.noOfDist=t.aData2.length,t.natureId2=t.cgData2.natureId;var a=JSON.parse(JSON.stringify(t.aData2)),r=a.sort(t.SortByRank);t.n=Object.keys(r).map(function(t){return r[t].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}),t.ds=Object.keys(r).map(function(t){return r[t].values}),t.higherLimit=t.ds[0],"Percent"==t.cgData2.unit||"Ratio"==t.cgData2.unit?(t.mins=.01,t.tofix=2,t.stp=.01):(t.mins=1,t.tofix=0,t.stp=1),0!=t.aData2.length?($("#map2").text(""),t.setLegend2(),t.setMap2(),"NA"==t.cgData2.values?$("#legendsection").hide():$("#legendsection").show()):($("#map").html("<b style='font-size:36px;  margin-left:150px'>No Data</b>"),$("#chartSection").html("<b style='font-size:36px;  margin-left:250px'>No Data</b>"))},t.setMap=function(){t.aData.sort(t.SortByName);var e,a=358,r=580;d3.select("#mapsvg").remove();var o=d3.geo.mercator().scale(4780).center([82.3224595,20.97702712140104]).translate([a/2,r/2]),n=d3.geo.path().projection(o),i=d3.select("body").select("#map").append("svg").attr("id","mapsvg").attr("width",350).attr("height",570);d3.json(t.mapUrl,function(o){function d(t,e){p.transition().duration(200).style("opacity",.8)}function s(e,a){p.html("District: "+t.aData[a].name+"<br/> Rank: "+t.aData[a].rank+"<br/>"+t.aData[a].values.toFixed(t.tofix)).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-110+"px")}function l(){p.transition().duration(500).style("opacity",0)}function c(t){var o,i,d;if(t&&e!==t){var s=n.centroid(t);o=s[0],i=s[1],d=4,e=t}else o=a/2,i=r/2,d=1,e=null;m.selectAll("path").classed("active",e&&function(t){return t===e}),m.transition().duration(750).attr("transform","translate("+a/2+","+r/2+")scale("+d+")translate("+-o+","+-i+")").style("stroke-width",1.5/d+"px")}var m=i.selectAll("g").data(o.features).enter().append("g").on("click",c),p=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);m.append("path").attr("d",n).style("fill",function(e,a){return t.aData[a].color}).style("stroke","white").on("mouseover",d).on("mousemove",s).on("mouseout",l).style("stroke-width",1);m.append("text").attr("class","maptxt").attr("x",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.1:"GARIYABAND"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.94:"JANJGIR-CHAMPA"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.08:"BEMETARA"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"RAIPUR"==t.aData[a].name.toUpperCase()&&"map/cg18.json"==t.mapUrl?n.centroid(e)[0]/1:n.centroid(e)[0]}).attr("y",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2;
}).attr("text-anchor","middle").text(function(e,a){return t.aData[a].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}).attr("font-size",11.5).on("mouseover",d).on("mousemove",s).on("mouseout",l),m.append("text").attr("class","mapvals").attr("x",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.07:"GARIYABAND"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.94:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[0]:n.centroid(e)[0]/1}).attr("y",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").html(function(e,a){return t.aData[a].values.toFixed(t.tofix)}).attr("transform","translate(0,10)").attr("font-size",10).on("mouseover",d).on("mousemove",s).on("mouseout",l)})},t.setLegend=function(){var e=0,a=0,r=0;$.each(t.ds,function(t,e){-1!=e&&r++}),r>2&&(e=Math.floor(r/3),a=2*e,r%3==2&&(e++,a++)),2==t.natureId&&t.ds.sort(function(t,e){return e-t}),t.low=parseFloat(t.ds[r-1].toFixed(t.tofix)),t.low2=parseFloat(t.ds[a].toFixed(t.tofix)),t.mid=parseFloat(t.ds[e].toFixed(t.tofix)),t.high=parseFloat(t.ds[0].toFixed(t.tofix)),2==t.natureId&&t.ds.sort(function(t,e){return t-e}),t.setCustomLegend()},t.setLegend2=function(){var e=0,a=0,r=0;$.each(t.ds,function(t,e){-1!=e&&r++}),r>2&&(e=Math.floor(r/3),a=2*e,r%3==2&&(e++,a++)),2==t.natureId2&&t.ds.sort(function(t,e){return e-t}),t.low=parseFloat(t.ds[r-1].toFixed(t.tofix)),t.low2=parseFloat(t.ds[a].toFixed(t.tofix)),t.mid=parseFloat(t.ds[e].toFixed(t.tofix)),t.high=parseFloat(t.ds[0].toFixed(t.tofix)),2==t.natureId2&&t.ds.sort(function(t,e){return t-e}),t.setCustomLegend2()},t.setCustomLegend=function(){var e,a=parseFloat(t.mid),r=parseFloat(t.low2+t.stp),o=parseFloat(t.low2),n=parseFloat(t.low),d=parseFloat(t.high),s=parseFloat(t.mid+t.stp);if(d>s&&a>r&&o>n){if(t.aData.sort(t.SortByRank),2==t.natureId)for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData[i].values.toFixed(t.tofix)),(e>=n&&o>=e||n>e)&&(t.aData[i].color="rgb(112, 219, 112)"),e>=r&&a>=e&&(t.aData[i].color="rgb(255, 184, 77)"),(e>=s&&d>=e||e>d)&&(t.aData[i].color="rgb(255, 121, 77)");else for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData[i].values.toFixed(t.tofix)),(e>=n&&o>=e||n>e)&&(t.aData[i].color="rgb(255, 121, 77)"),e>=r&&a>=e&&(t.aData[i].color="rgb(255, 184, 77)"),(e>=s&&d>=e||e>d)&&(t.aData[i].color="rgb(112, 219, 112)");t.aData.sort(t.SortByName)}else alert("invalid value")},t.setCustomLegend2=function(){var e,a=parseFloat(t.mid),r=parseFloat(t.low2+t.stp),o=parseFloat(t.low2),n=parseFloat(t.low),d=parseFloat(t.high),s=parseFloat(t.mid+t.stp);if(d>s&&a>r&&o>n){if(t.aData2.sort(t.SortByRank),2==t.natureId2)for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData2[i].values.toFixed(t.tofix)),(e>=n&&o>=e||n>e)&&(t.aData2[i].color="rgb(112, 219, 112)"),e>=r&&a>=e&&(t.aData2[i].color="rgb(255, 184, 77)"),(e>=s&&d>=e||e>d)&&(t.aData2[i].color="rgb(255, 121, 77)");else for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData2[i].values.toFixed(t.tofix)),(e>=n&&o>=e||n>e)&&(t.aData2[i].color="rgb(255, 121, 77)"),e>=r&&a>=e&&(t.aData2[i].color="rgb(255, 184, 77)"),(e>=s&&d>=e||e>d)&&(t.aData2[i].color="rgb(112, 219, 112)");t.aData2.sort(t.SortByName)}else alert("invalid value")},t.setMap2=function(){t.aData2.sort(t.SortByName);var e,a=358,r=580;d3.select("#mapsvg2").remove();var o=d3.geo.mercator().scale(4780).center([82.3224595,20.97702712140104]).translate([a/2,r/2]),n=d3.geo.path().projection(o),i=d3.select("body").select("#map2").append("svg").attr("id","mapsvg2").attr("width",350).attr("height",570);d3.json(t.mapUrl2,function(o){function d(t,e){p.transition().duration(200).style("opacity",.8)}function s(e,a){p.html("District: "+t.aData2[a].name+"<br/> Rank: "+t.aData2[a].rank+"<br/>"+t.aData2[a].values.toFixed(t.tofix)).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-110+"px")}function l(){p.transition().duration(500).style("opacity",0)}function c(t){var o,i,d;if(t&&e!==t){var s=n.centroid(t);o=s[0],i=s[1],d=4,e=t}else o=a/2,i=r/2,d=1,e=null;m.selectAll("path").classed("active",e&&function(t){return t===e}),m.transition().duration(750).attr("transform","translate("+a/2+","+r/2+")scale("+d+")translate("+-o+","+-i+")").style("stroke-width",1.5/d+"px")}var m=i.selectAll("g").data(o.features).enter().append("g").on("click",c),p=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);m.append("path").attr("d",n).style("fill",function(e,a){return t.aData2[a].color}).style("stroke","white").on("mouseover",d).on("mousemove",s).on("mouseout",l).style("stroke-width",1);m.append("text").attr("class","maptxt").attr("x",function(e,a){return"BILASPUR"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/1.1:"GARIYABAND"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/.94:"JANJGIR-CHAMPA"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/1.08:"BEMETARA"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/.9:"RAIPUR"==t.aData2[a].name.toUpperCase()&&"map/cg18.json"==t.mapUrl?n.centroid(e)[0]/1:n.centroid(e)[0]}).attr("y",function(e,a){return"BILASPUR"==t.aData2[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData2[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").text(function(e,a){return t.aData2[a].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}).attr("font-size",11.5).on("mouseover",d).on("mousemove",s).on("mouseout",l),m.append("text").attr("class","mapvals").attr("x",function(e,a){return"BILASPUR"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/1.07:"GARIYABAND"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData2[a].name.toUpperCase()?n.centroid(e)[0]/.94:"RAIPUR"!=t.aData2[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[0]:n.centroid(e)[0]/1}).attr("y",function(e,a){return"BILASPUR"==t.aData2[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData2[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").html(function(e,a){return t.aData2[a].values.toFixed(t.tofix)}).attr("transform","translate(0,10)").attr("font-size",10).on("mouseover",d).on("mousemove",s).on("mouseout",l)})},t.compare=function(){t.mapUrl==t.mapUrl2?(t.setCustomLegend(),t.setMap(),t.setCustomLegend2(),t.setMap2(),t.loadHbarChart(),t.loadChart2()):alert("Map not comparable")},t.loadHbarChart=function(){if(t.differenceData=[],"-"==t.operator){for(var e=0;e<t.barData.length;e++)t.differenceData.push((t.barData[e].toFixed(2)-t.barData2[e].toFixed(2)).toFixed(t.tofix));t.hBarLable="Difference: "+parseFloat(t.cgData.values-t.cgData2.values)}else if("+"==t.operator){for(var e=0;e<t.barData.length;e++)t.differenceData.push((t.barData[e]+t.barData2[e]).toFixed(t.tofix));t.hBarLable="Addition: "+parseFloat(t.cgData.values+t.cgData2.values)}else if("/"==t.operator){for(var e=0;e<t.barData.length;e++)t.differenceData.push((t.barData[e].toFixed(2)/t.barData2[e].toFixed(2)).toFixed(2));t.hBarLable="Division: "+parseFloat(t.cgData.values/t.cgData2.values)}else if("x"==t.operator){for(var e=0;e<t.barData.length;e++)t.differenceData.push((t.barData[e].toFixed(2)*t.barData2[e].toFixed(2)).toFixed(t.tofix));t.hBarLable="Multiplication: "+parseFloat(t.cgData.values*t.cgData2.values)}document.getElementById("hBarSection").innerHTML=' <canvas id="hBar" height="400%"> </canvas>';var a=document.getElementById("hBar");new Chart(a,{type:"horizontalBar",data:{labels:t.barLable,datasets:[{label:t.hBarLable,data:t.differenceData,backgroundColor:"#26B99A"}]},options:{events:!1,showTooltips:!1,animation:{onComplete:function(){var t=this.chart.ctx;t.textAlign="center",t.textBaseline="middle";var e=this,a=this.config.data.datasets;a.forEach(function(r,o){t.font="10px Arial",t.fillStyle="#000",e.getDatasetMeta(o).data.forEach(function(e,r){a[o].data[r]>0?t.fillText(a[o].data[r],e._model.x+20,e._model.y):t.fillText(a[o].data[r],e._model.x-20,e._model.y)})})}},scales:{yAxes:[{ticks:{fontSize:"11",fontColor:"#666"},barPercentage:.5}],xAxes:[{ticks:{fontSize:"12",categorySpacing:"20",fontColor:"#666"}}]},legend:{display:!0,labels:{fontSize:18}}}})},t.loadChart2=function(){Chart.defaults.global.defaultFontColor="#666",document.getElementById("chartSection2").innerHTML=' <canvas id="barChart2" height="90%"> </canvas>';var e=document.getElementById("barChart2");new Chart(e,{type:"bar",data:{labels:t.barLable,datasets:[{label:"First dataset ",data:t.barData,scaleFontColor:"#fff",backgroundColor:"#0AB0B4"},{label:"Second dataset",data:t.barData2,scaleFontColor:"#fff",backgroundColor:"#666"}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!1,min:0,fontColor:"#666"}}],xAxes:[{ticks:{fontSize:"10",categorySpacing:"20",fontColor:"#666"},barPercentage:.4}]}}})},t.pdfDownload=function(){t.pdfLoader="fa-spinner fa-spin";var e,a,r=$("#map"),o=$("#map2"),n=$("#barChart2"),i=$("#hBarSection");$("#map").css("color","rgba(255,0,0,0)"),$("#map").css("background-color","white"),$("#map2").css("color","rgba(255,0,0,0)"),$("#map2").css("background-color","white"),$("#hBarSection").css("background-color","rgb(255,255,255)"),$("#barChart2").css("background-color","rgb(255,255,255)");var d=new jsPDF("landscape","pt"),s=d.internal.pageSize.width,l=d.internal.pageSize.height,c=s/2-13*d.getStringUnitWidth(t.pageHeading)/2;html2canvas(o,{onrendered:function(t){e=t;var a=e.toDataURL("image/jpeg",1);d.addImage(a,"JPEG",10,80,310,l-130),$("#map2").removeAttr("style"),d.setDrawColor(0),d.setFontSize(10),d.setFillColor(112,219,112),d.rect(160,450,10,10,"FD"),d.setFillColor(255,184,77),d.rect(160,465,10,10,"FD"),d.setFillColor(255,121,77),d.rect(160,480,10,10,"FD")}}),html2canvas(r,{onrendered:function(a){e=a;var r=e.toDataURL("image/jpeg",1);d.addImage(r,"JPEG",290,80,310,l-130),$("#map").removeAttr("style"),d.setDrawColor(0),d.setFontSize(10),d.setFillColor(112,219,112),d.rect(430,450,10,10,"FD"),d.setFillColor(255,184,77),d.rect(430,465,10,10,"FD"),d.setFillColor(255,121,77),d.rect(430,480,10,10,"FD"),d.text(180,460,t.mid+t.stp+" - "+t.high),d.text(180,475,t.low2+t.stp+" - "+t.mid),d.text(180,490,t.low+" - "+t.low2),d.text(450,460,t.mid+t.stp+" - "+t.high),d.text(450,475,t.low2+t.stp+" - "+t.mid),d.text(450,490,t.low+" - "+t.low2)}}),html2canvas(i,{onrendered:function(r){e=r;var o=e.toDataURL("image/jpeg",1);d.addImage(o,"JPEG",560,80,280,l-110),html2canvas(n,{onrendered:function(e){if(t.printChart){a=e;var r=a.toDataURL("image/jpeg",1);d.addPage(),d.setFontSize(13),d.text(c,25,t.pageHeading),d.setLineWidth(.2),d.line(20,32,s-10,32),d.setFontSize(11),d.text(20,50,"First Dataset: "+$("#ddlSector option:selected").text()+", "+$("#ddlIndicator option:selected").text()+", "+$("#ddlYear option:selected").text()+", "+$("#ddlSource option:selected").text()),d.text(20,70,"Second Dataset: "+t.ddlSector.sectorName+", "+t.ddlIndicator.indicatorName+", "+t.ddlYear.year+", "+t.ddlSource.sourceName),d.addImage(r,"JPEG",20,100,s-50,l-250),d.line(0,l-20,s,l-20),d.setFontSize(10),d.text(s-300,l-10,"Directorate of Economics and Statistics, Chhattisgarh")}if(t.printTable){d.addPage(),d.setFontSize(13),d.text(c,25,t.pageHeading),d.setLineWidth(.2),d.line(20,32,s-10,32);for(var o=["Sno","District",$("#ddlIndicator option:selected").text()+" ["+$("#ddlYear option:selected").text()+"]",t.ddlIndicator.indicatorName+" ["+t.ddlYear.year+"]",t.hBarLable],n=[],i=0;i<t.barLable.length;i++)n[i]=[i+1,t.barLable[i],t.barData[i],t.barData2[i],t.differenceData[i]];d.autoTable(o,n,{startY:40,styles:{overflow:"linebreak",fontSize:10.5,cellPadding:3}}),d.line(0,l-20,s,l-20),d.setFontSize(10),d.text(s-270,l-10,"Directorate of Economics and Statistics, Chhattisgarh")}d.save("CG Dashboard.pdf"),t.pdfLoader="fa-file-pdf-o",t.$apply()}})}}),d.setFontSize(13),d.text(c,25,t.pageHeading),d.setLineWidth(.2),d.line(20,32,s-10,32),d.setFontSize(11),d.text(300,50,$("#ddlSector option:selected").text()+", "+$("#ddlIndicator option:selected").text()+", "+$("#ddlYear option:selected").text()+", "+$("#ddlSource option:selected").text()),d.text(20,50,t.ddlSector.sectorName+", "+t.ddlIndicator.indicatorName+", "+t.ddlYear.year+", "+t.ddlSource.sourceName),d.text(340,73,"Chhattisgarh: "+t.cgData.values),d.text(30,73,"Chhattisgarh: "+t.cgData2.values),d.line(0,l-20,s,l-20),d.setFontSize(10),d.text(s-300,l-10,"Directorate of Economics and Statistics, Chhattisgarh")},t.advancePdf=function(){t.pdfLoader="fa-spinner fa-spin";var e,a,r=$("#map"),o=$("#map2"),n=$("#barChart2"),i=$("#hBarSection");$("#map").css("color","rgba(255,0,0,0)"),$("#map").css("background-color","white"),$("#map2").css("color","rgba(255,0,0,0)"),$("#map2").css("background-color","white"),$("#hBarSection").css("background-color","rgb(255,255,255)"),$("#barChart2").css("background-color","rgb(255,255,255)");var d=new jsPDF("landscape","pt"),s=d.internal.pageSize.width,l=d.internal.pageSize.height;html2canvas(r,{onrendered:function(a){e=a;var r=e.toDataURL("image/jpeg",1);d.addImage(r,"JPEG",10,80,310,l-110),$("#map").removeAttr("style"),d.setDrawColor(0),d.setFontSize(10),d.setFillColor(112,219,112),d.rect(160,450,10,10,"FD"),d.setFillColor(255,184,77),d.rect(160,465,10,10,"FD"),d.setFillColor(255,121,77),d.rect(160,480,10,10,"FD"),d.text(180,460,t.mid+t.stp+" - "+t.high),d.text(180,475,t.low2+t.stp+" - "+t.mid),d.text(180,490,t.low+" - "+t.low2),html2canvas(o,{onrendered:function(a){e=a;var r=e.toDataURL("image/jpeg",1);d.addImage(r,"JPEG",290,80,310,l-110),$("#map2").removeAttr("style"),d.setDrawColor(0),d.setFontSize(10),d.setFillColor(112,219,112),d.rect(430,450,10,10,"FD"),d.setFillColor(255,184,77),d.rect(430,465,10,10,"FD"),d.setFillColor(255,121,77),d.rect(430,480,10,10,"FD"),d.text(450,460,t.mid+t.stp+" - "+t.high),d.text(450,475,t.low2+t.stp+" - "+t.mid),d.text(450,490,t.low+" - "+t.low2)}})}}),html2canvas(i,{onrendered:function(r){e=r;var o=e.toDataURL("image/jpeg",1);d.addImage(o,"JPEG",560,80,280,l-110),html2canvas(n,{onrendered:function(e){a=e;var r=a.toDataURL("image/jpeg",1);d.addPage(),d.text(20,20,"First Dataset: "+$("#ddlSector option:selected").text()+", "+$("#ddlIndicator option:selected").text()+", "+$("#ddlYear option:selected").text()+", "+$("#ddlSource option:selected").text()),d.text(20,40,"Second Dataset: "+t.ddlSector.sectorName+", "+t.ddlIndicator.indicatorName+", "+t.ddlYear.year+", "+t.ddlSource.sourceName),d.addImage(r,"JPEG",20,70,s-50,l-250),d.addPage();for(var o=["Sno","District",$("#ddlIndicator option:selected").text()+" ["+$("#ddlYear option:selected").text()+"]",t.ddlIndicator.indicatorName+" ["+t.ddlYear.year+"]",t.hBarLable],n=[],i=0;i<t.barLable.length;i++)n[i]=[i+1,t.barLable[i],t.barData[i],t.barData2[i],t.differenceData[i]];d.autoTable(o,n,{startY:40,styles:{overflow:"linebreak",fontSize:10.5,cellPadding:3}}),d.save("CG Dashboard.pdf"),t.pdfLoader="fa-file-pdf-o",t.$apply()}})}}),d.setFontSize(13),d.text(260,25,document.getElementById("txtHeading").innerText),d.setFontSize(11),d.text(20,50,$("#ddlSector option:selected").text()+" ["+$("#ddlIndicator option:selected").text()+"], "+$("#ddlYear option:selected").text()+", "+$("#ddlSource option:selected").text()),d.text(300,50,t.ddlSector.sectorName+", "+t.ddlIndicator.indicatorName+", "+t.ddlYear.year+", "+t.ddlSource.sourceName),d.text(30,73,"Chhattisgarh: "+t.cgData.values),d.text(340,73,"Chhattisgarh: "+t.cgData2.values),d.setLineWidth(.2),d.line(10,32,s-10,32)}}]),app.controller("indiaCtrl",["$scope",function(t){t.areaLevel=1,t.stp=1,t.setDashboard=function(e){t.cgData=e[0],t.aData=e[1],$(".tooltip").hide(),t.mapUrl="map/"+t.cgData.mapUrl,t.natureId=t.cgData.natureId,t.noOfDist=t.aData.length;var a=JSON.parse(JSON.stringify(t.aData)),r=a.sort(t.SortByRank);t.n=Object.keys(r).map(function(t){return-1!=r[t].values?r[t].name+"("+r[t].rank+")":void 0}),t.label=Object.keys(r).map(function(t){return-1!=r[t].values?r[t].name:void 0}),t.ds=Object.keys(r).map(function(t){return-1!=r[t].values?r[t].values:void 0});var o=t.n,n=t.label,i=t.ds;t.n=[],t.label=[],t.ds=[];for(var d=0;d<o.length;d++)null!=o[d]&&t.n.push(o[d]),null!=n[d]&&t.label.push(n[d]),null!=i[d]&&t.ds.push(i[d]);t.higherLimit=t.ds[0],"Percent"==t.cgData.unit||"Ratio"==t.cgData.unit||"Rate"==t.cgData.unit?(t.mins=.01,t.tofix=2,t.stp=.01):(t.mins=1,t.tofix=0,t.stp=1),0!=t.aData.length?($("#map").text(""),t.setLegend(),"NA"==t.cgData.values?$("#legendsection").hide():$("#legendsection").show(),$("#distName").text(t.cgData.name),$("#cgData").text(t.cgData.values.toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#txtUnit").text(t.cgData.unit),$("#txtCG").text(IndicatorName),t.setCentralTendancy(t.label,t.ds),t.loadChart(t.n,t.ds)):($("#map").html("<b style='font-size:36px;  margin-left:150px'>No Data</b>"),$("#chartSection").html("<b style='font-size:36px;  margin-left:250px'>No Data</b>"))},t.setChartLimit=function(){for(var e=0,a=JSON.parse(JSON.stringify(t.ds)),r=0;r<t.ds.length;r++)t.ds[r]>t.lowerLimit?e+=1:a[r]=t.lowerLimit;t.noOfDist=e,t.loadChart(t.n,a)},t.SortByRank=function(t,e){var a=parseInt(t.rank),r=parseInt(e.rank);return r>a?-1:a>r?1:0},t.SortByRankDesc=function(t,e){var a=parseInt(e.rank),r=parseInt(t.rank);return r>a?-1:a>r?1:0},t.SortByName=function(t,e){var a=t.name,r=e.name;return r>a?-1:a>r?1:0},t.setMap=function(){t.aData.sort(t.SortByName);var e,a=530,r=580;d3.select("#mapsvg").remove();var o=d3.geo.mercator().scale(981.410056709862).center([82.7676795,22.783265396645834]).translate([a/2,r/2]),n=d3.geo.path().projection(o);d3.json("map/INDIA35.json",function(o){function i(e,a){p.transition().duration(200).style("opacity",.8),$("#cgData").html(t.aData[a].values.toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#distName").text(t.aData[a].name)}function d(e,a){p.html("District: "+t.aData[a].name+"<br/> Rank: "+t.aData[a].rank+"<br/>"+t.aData[a].values.toFixed(t.tofix)).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-110+"px")}function s(){p.transition().duration(500).style("opacity",0),$("#cgData").html(t.cgData.values.toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#distName").text(t.cgData.name)}function l(t){var o,i,d;if(t&&e!==t){var s=n.centroid(t);o=s[0],i=s[1],d=4,e=t}else o=a/2,i=r/2,d=1,e=null;m.selectAll("path").classed("active",e&&function(t){return t===e}),m.transition().duration(750).attr("transform","translate("+a/2+","+r/2+")scale("+d+")translate("+-o+","+-i+")").style("stroke-width",1.5/d+"px")}var c=d3.select("body").select("#map").append("svg").attr("id","mapsvg").attr("width",550).attr("height",570),m=c.selectAll("g").data(o.features).enter().append("g").on("click",l),p=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);m.append("path").attr("d",n).style("fill",function(e,a){return t.aData[a].color}).style("stroke","white").on("mouseover",i).on("mousemove",d).on("mouseout",s).style("stroke-width",1);m.append("text").attr("class","maptxt").attr("x",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.1:"GARIYABAND"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.94:"JANJGIR-CHAMPA"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.07:"BEMETARA"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"RAIPUR"==t.aData[a].name.toUpperCase()&&"map/cg18.json"==t.mapUrl?n.centroid(e)[0]/1:n.centroid(e)[0]}).attr("y",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").text(function(e,a){return t.aData[a].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}).attr("font-size",11.5).on("mouseover",i).on("mousemove",d).on("mouseout",s),m.append("text").attr("class","mapvals").attr("x",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/1.07:"GARIYABAND"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.9:"BALRAMPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[0]/.94:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[0]:n.centroid(e)[0]/1}).attr("y",function(e,a){return"BILASPUR"==t.aData[a].name.toUpperCase()?n.centroid(e)[1]/1.2:"RAIPUR"!=t.aData[a].name.toUpperCase()||"map/cg18.json"!=t.mapUrl&&"map/cg16.json"!=t.mapUrl?n.centroid(e)[1]:n.centroid(e)[1]/1.2}).attr("text-anchor","middle").html(function(e,a){return t.aData[a].values.toFixed(t.tofix)}).attr("transform","translate(0,10)").attr("font-size",10).on("mouseover",i).on("mousemove",d).on("mouseout",s)})},t.loadChart=function(e,a){$("#chartSection").html(' <canvas id="barChart" style="width:100%;"> </canvas>');var r=document.getElementById("barChart");new Chart(r,{type:"bar",data:{labels:e,datasets:[{label:IndicatorName,data:a,scaleFontColor:"#ff0000",backgroundColor:"#26B99A"}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!1,min:t.lowerLimit,fontColor:"#000"},gridLines:{display:!1}}],xAxes:[{ticks:{fontSize:"10",categorySpacing:"20",fontColor:"#000"},barPercentage:.3,gridLines:{display:!1}}]}}})},t.setCentralTendancy=function(e,a){var r=0;for(i=0;i<a.length;i++)r+=a[i];r/=a.length,t.meanValue=r.toFixed(t.tofix),t.nearMean=e[t.getClosest(r,a)];var o=0,n=Math.floor(a.length/2);a.length%2==1?(t.medianValue=a[n].toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),t.nearMedian=e[n]):(o=(a[n-1]+a[n])/2,t.medianValue=o.toFixed(t.tofix).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"),t.nearMedian=e[n-1]+" and \n "+e[n]),t.range=a[a.length-1].toFixed(t.tofix)+"-"+a[0].toFixed(t.tofix)},t.getClosest=function(t,e){for(var a=0,r=Math.abs(t-a),o=e.length;o--;){var n=Math.abs(t-e[o]);r>n&&(r=n,a=o)}return a},t.setLegend=function(){var e=0,a=0,r=0;$.each(t.ds,function(t,e){-1!=e&&r++}),r>2&&(e=Math.floor(r/3),a=2*e,r%3==2&&(e++,a++)),2==t.natureId&&t.ds.sort(function(t,e){return e-t}),$("#txthigh2").val((t.ds[e]+t.mins).toFixed(t.tofix)),$("#txthigh1").val(t.ds[0].toFixed(t.tofix)),$("#txtmid2").val((t.ds[a]+t.mins).toFixed(t.tofix)),$("#txtmid1").val(t.ds[e].toFixed(t.tofix)),$("#txtlow2").val(t.ds[r-1].toFixed(t.tofix)),$("#txtlow1").val(t.ds[a].toFixed(t.tofix)),2==t.natureId&&t.ds.sort(function(t,e){return t-e}),t.setCustomLegend()},t.setCustomLegend=function(){var e,a="",r="",o="",n=parseFloat($("#txtmid1").val()),d=parseFloat($("#txtmid2").val()),s=parseFloat($("#txtlow1").val()),l=parseFloat($("#txtlow2").val()),c=parseFloat($("#txthigh1").val()),m=parseFloat($("#txthigh2").val()),p=0,u=0,g=0;if(c>m&&n>d&&s>l){if(t.aData.sort(t.SortByRank),2==t.natureId)for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData[i].values.toFixed(t.tofix)),e>=l&&s>=e&&(t.aData[i].color="rgb(112, 219, 112)",a=a+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",p+=1),e>=d&&n>=e&&(t.aData[i].color="rgb(255, 184, 77)",r=r+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",u+=1),e>=m&&c>=e&&(t.aData[i].color="rgb(255, 121, 77)",o=o+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",g+=1);else for(i=0;i<t.ds.length;i++)e=parseFloat(t.aData[i].values.toFixed(t.tofix)),e>=l&&s>=e&&(t.aData[i].color="rgb(255, 121, 77)",o=o+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",g+=1),e>=d&&n>=e&&(t.aData[i].color="rgb(255, 184, 77)",r=r+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",u+=1),e>=m&&c>=e&&(t.aData[i].color="rgb(112, 219, 112)",a=a+" "+t.aData[i].name.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})+",",p+=1);$(".high2").text($("#txthigh2").val()),$(".high1").text($("#txthigh1").val()),$(".mid2").text($("#txtmid2").val()),$(".mid1").text($("#txtmid1").val()),$(".low2").text($("#txtlow2").val()),$(".low1").text($("#txtlow1").val()),$("#highDist").text(a),$("#midDist").text(r),$("#lowDist").text(o),$("#highTotal").text(p),$("#midTotal").text(u),$("#lowTotal").text(g),t.aData.sort(t.SortByName),t.setMap()}else alert("invalid value")}}]),app.controller("loginController",["$scope","LoginService",function(t,e){sessionStorage.IsLogedIn?(t.Message=sessionStorage.Message,$("#logout").show(),$("#login").hide()):(t.Message="",$("#logout").hide(),$("#login").show()),t.Submitted=!1,t.IsFormValid=!1,t.LoginData={Username:"",Password:""},t.$watch("f1.$valid",function(e){t.IsFormValid=e}),t.Login=function(){t.Submitted=!0,t.IsFormValid&&e.GetUser(t.LoginData).then(function(t){null!=t.data.username?(sessionStorage.IsLogedIn=!0,sessionStorage.Message=t.data.fullName,window.location.href="dashboard.html"):alert("Invalid Credential!")})},t.logout=function(){delete sessionStorage.Message,delete sessionStorage.IsLogedIn,$("#logout").hide(),$("#login").show(),t.Message=""}}]).factory("LoginService",["$http",function(t){var e={};return e.GetUser=function(e){return t({url:baseUrl+"api/user/GetUser",method:"POST",data:JSON.stringify(e),headers:{"content-type":"application/json"}})},e}]),app.controller("uploadController",["$scope","$http",function(t,e){t.insertData=function(){t.excelData=excelOutput,e({url:baseUrl+"api/user/PostExcelData",method:"POST",data:JSON.stringify(t.excelData),headers:{"content-type":"application/json"}})}}]),app.controller("globleCtrl",["$scope",function(t){function e(t){var e=$(window).height(),a=$(window).width(),r=$("#content").height();e&&$("#content").css("min-height",e),r&&$("#sidebar-left2").css("height",r),980>a&&a>767?($("#sidebar-left").hasClass("span2")&&($("#sidebar-left").removeClass("span2"),$("#sidebar-left").addClass("span1")),$("#content").hasClass("span10")&&($("#content").removeClass("span10"),$("#content").addClass("span11")),$("a").each(function(){$(this).hasClass("quick-button-small span1")&&($(this).removeClass("quick-button-small span1"),$(this).addClass("quick-button span2 changed"))}),$(".circleStatsItem, .circleStatsItemBox").each(function(){var t=$(this).parent().attr("onTablet"),e=$(this).parent().attr("onDesktop");t&&($(this).parent().removeClass(e),$(this).parent().addClass(t))}),$(".box").each(function(){var t=$(this).attr("onTablet"),e=$(this).attr("onDesktop");t&&($(this).removeClass(e),$(this).addClass(t))}),$(".widget").each(function(){var t=$(this).attr("onTablet"),e=$(this).attr("onDesktop");t&&($(this).removeClass(e),$(this).addClass(t))}),$(".statbox").each(function(){var t=$(this).attr("onTablet"),e=$(this).attr("onDesktop");t&&($(this).removeClass(e),$(this).addClass(t))})):($("#sidebar-left").hasClass("span1")&&($("#sidebar-left").removeClass("span1"),$("#sidebar-left").addClass("span2")),$("#content").hasClass("span11")&&($("#content").removeClass("span11"),$("#content").addClass("span11")),$("a").each(function(){$(this).hasClass("quick-button span2 changed")&&($(this).removeClass("quick-button span2 changed"),$(this).addClass("quick-button-small span1"))}),$(".circleStatsItem, .circleStatsItemBox").each(function(){var t=$(this).parent().attr("onTablet"),e=$(this).parent().attr("onDesktop");t&&($(this).parent().removeClass(t),$(this).parent().addClass(e))}),$(".box").each(function(){var t=$(this).attr("onTablet"),e=$(this).attr("onDesktop");t&&($(this).removeClass(t),$(this).addClass(e))}),$(".widget").each(function(){var t=$(this).attr("onTablet"),e=$(this).attr("onDesktop");t&&($(this).removeClass(t),$(this).addClass(e))}))}function a(t){return t.toFixed(0).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}function r(){var t=.018308203;today=new Date,statsdate=new Date("March 1, 2011");var e=25545198,r=Math.abs((today-statsdate)/1e3),o=parseInt(e)+parseFloat(r*t);$("#population").html(a(o))}jQuery(document).ready(function(t){t(".messagesList").width()&&"8."==jQuery.browser.version.substring(0,2)&&t("ul.messagesList li:nth-child(2n+1)").addClass("odd")}),$(document).ready(function(){$(".popCounter").counterUp({delay:10,time:1500}),e()}),$(window).bind("resize",e),$(function(){"use strict";$(".connectedSortable").sortable({dropOnEmpty:!0}),$(".rowSortable").sortable({dropOnEmpty:!0})}),$("#cbDistName").change(function(){this.checked?$(".maptxt").show():$(".maptxt").hide()}),$("#cbDistValue").change(function(){this.checked?$(".mapvals").show():$(".mapvals").hide()}),setInterval(r,1e3),$(".flip").click(function(){return $(this).find(".card").addClass("flipped").dblclick(function(){$(this).removeClass("flipped")}),!1})}]);